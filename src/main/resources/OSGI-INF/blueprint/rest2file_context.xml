<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
       http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
       http://camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint.xsd">


<!--  Service definition for Swagger, not used at this point, swagger offers a nice UI to browse and execute REST APIs -->
<service interface="javax.servlet.http.HttpServlet">
        <service-properties>
            <entry key="base.path" value="rest"/>
            <entry key="api.path" value="api-docs"/>
            <entry key="api.title" value="Rest API"/>
            <entry key="api.version" value="1.0"/>
            <entry key="api.description" value="Demo API"/>
        </service-properties>
        <bean class="org.apache.camel.component.swagger.DefaultCamelSwaggerServlet" />
</service>


<!-- Java Class to marshall the JSON message in, currently not used, but handy if transformation and operations on the message are needed -->
<bean id="myMessage" class="org.demo.camel.rabbitmq.Message"/>


<!--  Camel Context for route execution -->
<camelContext id="rest2file" xmlns="http://camel.apache.org/schema/blueprint">
  <dataFormats>
    <json library="Jackson" unmarshalTypeName="org.demo.camel.rabbitmq.Message" id="jack"/>
  </dataFormats>
  <restConfiguration component="jetty" host="0.0.0.0" port="9090" bindingMode="json"/>
  <rest consumes="application/json" produces="application/json">
    <description>Message REST Service put operation on the /message path calls direct: endpoint. See route below</description>
    <put uri="/message" type="org.demo.camel.rabbitmq.Message">
      <description>Send JSON Message to file</description>
      <to uri="direct:storeMessage"/>
    </put>
  </rest>
  <route id="SendToRabbitMQRoute">
    <from uri="direct:storeMessage"/>
    <marshal ref="jack"/>
    <log message="MSG: ${body}" loggingLevel="INFO"/>
    <to uri="file:target/data?fileName=message-${date:now:yyyyMMddhhmmss}.json"/>
  </route>
</camelContext>

</blueprint>
